@using App.Data;
@using Microsoft.AspNetCore.Identity
@using App.Models

@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> userManager 
@inject RoleManager<IdentityRole> roleManager
@{
	var user = await userManager.GetUserAsync(User);
	//if user is not logged in, set role_name to "Khách"
	var role_name = user == null ? "Khách" : (await userManager.GetRolesAsync(user)).FirstOrDefault();
	//if user is logged in, and role_name is null, set role_name to "Khách"
if (User.Identity.IsAuthenticated && role_name == null)
    {
        role_name = "Khách";
    }
	var role = await roleManager.FindByNameAsync(role_name);
}

@if (User.Identity.IsAuthenticated)
{
	<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-primary fw-bold py-4 fs-6 w-275px" data-kt-menu="true">
		<!--begin::Menu item-->
		<div class="menu-item px-3">
			<div class="menu-content d-flex align-items-center px-3">
				<!--begin::Avatar-->
				<div class="symbol symbol-50px me-5">
					<img alt="Logo" src="assets/media/avatars/150-25.jpg" />
				</div>
				<!--end::Avatar-->
				<!--begin::Username-->
				<div class="d-flex flex-column">
					<div class="fw-bolder d-flex align-items-center fs-5">
						<span style="background: url(/16066101745881.gif)">@User.Identity.Name</span>
						<span class="badge badge-light-success fw-bolder fs-8 px-2 py-1 ms-2">@role</span>
					</div>
					<a href="#" class="fw-bold text-muted text-hover-primary fs-7"></a>
				</div>
				<!--end::Username-->
			</div>
		</div>
		<!--end::Menu item-->
		<!--begin::Menu separator-->
		<div class="separator my-2"></div>
		<!--end::Menu separator-->
		@if (SignInManager.IsSignedIn(User) && (User.IsInRole(RoleName.Administrator) || User.IsInRole(RoleName.Editor)))
		{
			<div class="menu-item px-5 show menu-dropdown" data-kt-menu-trigger="hover" data-kt-menu-placement="left-start">
				<a href="#" class="menu-link px-5">
					<span class="menu-title">Manager</span>
					<span class="menu-arrow"></span>
				</a>
				<!--begin::Menu sub-->
				<div class="menu-sub menu-sub-dropdown w-175px py-4 show" style="z-index: 106; position: fixed; inset: 0px 0px auto auto; margin: 0px; transform: translate3d(-275px, 172px, 0px);" data-popper-placement="left-start">
					<!--begin::Menu item-->
					<div class="menu-item px-3">
						<a class="dropdown-item" asp-action="Index" asp-controller="DbManage" asp-area="Database">Database</a>
					</div>
					<!--end::Menu item-->
					<!--begin::Menu item-->
					<div class="menu-item px-3">
						<a class="dropdown-item" asp-action="Index" asp-controller="Role" asp-area="Identity">Quản lý Role</a>
					</div>
					<!--end::Menu item-->
					<!--begin::Menu item-->
					<div class="menu-item px-3">
						<a class="dropdown-item" asp-action="Index" asp-controller="User" asp-area="Identity">Quản lý User</a>
					</div>
					<!--end::Menu item-->
					<!--begin::Menu item-->
					<div class="menu-item px-3">
						<a class="dropdown-item" asp-action="Index" asp-controller="Products">Quản lý Sản Phẩm</a>
					</div>
					<div class="menu-item px-3">
						<a class="dropdown-item" asp-action="Index" asp-controller="Categories">Quản lý doanh mục</a>
					</div>
					<!--end::Menu item-->
					<!--begin::Menu separator-->
					<div class="separator my-2"></div>
					<!--end::Menu separator-->
				</div>
				<!--end::Menu sub-->
			</div>
		}
		<!--begin::Menu item-->
		<div class="menu-item px-5">
			<a class="nav-link" asp-area="Identity" asp-controller="Manage" asp-action="Index" title="Manage">My Profile</a>
		</div>
		<div class="menu-item px-5">
			<a class="nav-link" asp-controller="Products" asp-action="Index" title="Manage">Product</a>
		</div>
		<div class="menu-item px-5">
			<form asp-area="Identity" asp-controller="Account" asp-action="LogOff" method="post" id="logoutForm" class="navbar-right">
				<button type="submit" class="btn btn-link navbar-btn navbar-link">Sign Out</button>
			</form>
		</div>
		<!--end::Menu item-->
	</div>
}
else
{
	<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-primary fw-bold py-4 fs-6 w-275px" data-kt-menu="true">
		<div class="menu-item px-3">
			<a class="nav-link" asp-area="Identity" asp-controller="Account" asp-action="Register">Đăng ký</a>
			<a class="nav-link" asp-area="Identity" asp-controller="Account" asp-action="Login">Đăng nhập</a>
		</div>
	</div>
}

